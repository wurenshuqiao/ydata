<extend name="Public:base" />
<block name="title">
    <title>user</title>
</block>
<block name="header"><script src="__PUBLIC__/admin/js/baiduTemplate.js"></script></block>
<block name="nav">
    <ul class="nav nav-pills nav-stacked custom-nav">
        <li><a href="../Index/index.html"><i class="fa fa-home"></i> <span>首页</span></a></li>
        <li class="menu-list"><a href=""><i class="fa fa-random"></i> <span>周期走势</span></a>
            <ul class="sub-menu-list">
                <li><a href="{:U('Trend/exponential')}"> 支持指数与参与指数</a></li>
                <li><a href="{:U('Trend/analyse')}"> 类目分析</a></li>
                <li><a href="{:U('Trend/participate')}"> 类目参与</a></li>
                <li><a href="{:U('Trend/line')}"> 项目上线</a></li>
                <li><a href="{:U('Trend/realtime')}"> 实时统计</a></li>
                <li><a href="{:U('Trend/timesharing')}"> 分时统计</a></li>
                <li><a href="{:U('Trend/download')}"> 下载量</a></li>
                <li><a href="{:U('Trend/register')}"> 用户周期</a></li>
                <li><a href="{:U('Trend/active')}"> 活跃用户</a></li>
            </ul>
        </li>
        <li class="menu-list"><a href=""><i class="fa fa-male"></i> <span>人群分析</span></a>
            <ul class="sub-menu-list">
                <li><a href="{:U('People/population')}"> 人群特性</a></li>
                <li><a href="{:U('People/support')}"> 用户支持</a></li>
                <li><a href="{:U('People/region')}"> 地域分析</a></li>
                <li><a href="{:U('People/hierarchy')}"> 消费层级</a></li>
                <li><a href="{:U('People/passes')}"> 消费次数</a></li>
            </ul>
        </li>
        <li class="menu-list"><a href=""><i class="fa fa-cogs"></i> <span>需求分析</span></a>
            <ul class="sub-menu-list">
                <li><a href="{:U('Require/dispersion')}"> 类目分布</a></li>
                <li><a href="{:U('Require/project')}"> 项目基础数据</a></li>
                <li><a href="{:U('Require/market')}"> 市场细分</a></li>
                <li><a href="{:U('Require/channel')}"> 渠道来源</a></li>
            </ul>
        </li>
        <li class="menu-list nav-active"><a href=""><i class="fa fa-comment"></i> <span>微信统计</span></a>
            <ul class="sub-menu-list">
                <li class="active"><a href="{:U('Statistics/user')}"> 用户分析</a></li>
                <li><a href="{:U('Statistics/teletext')}"> 图文分析</a></li>
                <li><a href="{:U('Statistics/message')}"> 消息分析</a></li>
            </ul>
        </li>
        <li><a href="{:U('Login/index')}"><i class="fa fa-sign-in"></i> <span>登录 页面</span></a></li>
    </ul>
</block>
<block name="content">
    <div class="wrapper">
        <div class="row">
            <div class="col-md-12">
                <div class="square-widget">
                    <div class="widget-container">
                        <div class="stepy-tab">
                            <ul id="default-titles" class="stepy-titles clearfix">
                                <li class="current-step" id="zonghezhishu">
                                    <a href="{:U('Statistics/user')}">综合指数</a>
                                </li>
                                <li id="kaishiba">
                                    <a href="{:U('Statistics/userkaishiba')}">开始吧</a>
                                </li>
                                <li id="chaping">
                                    <a href="{:U('Statistics/userchaping')}">差评</a>
                                </li>
                                <li id="yirenyicheng">
                                    <a href="{:U('Statistics/useryirenyicheng')}">一人一城</a>
                                </li>
                                <li id="muzhiyuedu">
                                    <a href="{:U('Statistics/usermuzhiyuedu')}">拇指阅读</a>
                                </li>
                                <li id="erguniangjia">
                                    <a href="{:U('Statistics/usererguniangjia')}">二姑娘家</a>
                                </li>
                                <li id="jianghu">
                                    <a href="{:U('Statistics/userjianghu')}">江湖</a>
                                </li>
                                <li id="xingzhoumo">
                                    <a href="{:U('Statistics/userxingzhoumo')}">行周末</a>
                                </li>
                                <li id="huaixunjiemei">
                                    <a href="{:U('Statistics/userhuaixunjiemei')}">坏寻姐妹</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="multiple-content">
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            总粉丝数
                                <span class="tools pull-right">
                                    <a href="javascript:;" class="fa fa-chevron-down"></a>
                                    <a href="javascript:;" class="fa fa-times"></a>
                                 </span>
                        </header>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <table class="table table-bordered">
                                            <thead>
                                            <tr>
                                                <th>开始吧</th>
                                                <th>差评</th>
                                                <th>一人一城</th>
                                                <th>拇指阅读</th>
                                                <th>二姑娘家</th>
                                                <th>江湖</th>
                                                <th>行周末</th>
                                                <th>坏寻姐妹</th>
                                            </tr>
                                            </thead>
                                            <tbody id='test'>
                                            </tbody>
                                        </table>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            昨日关键指标
                                <span class="tools pull-right">
                                    <a href="javascript:;" class="fa fa-chevron-down"></a>
                                    <a href="javascript:;" class="fa fa-times"></a>
                                 </span>
                        </header>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <div class="info_bd">
                                            <div class="content" id="js_keydata">
                                                <table class="ui_trendgrid ui_trendgrid_3">
                                                    <tbody>
                                                        <tr>
                                                            <td class="first">
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>

                                                                   
                                                                    <dl id='kai_user'>
                                                                        <dt><b>开始吧</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong></strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                        <dd>周 <i class="icon_equal" title="上升"></i><b>--</b></dd>
                                                                        <dd>月 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl id="cha_user">
                                                                        <dt><b>差评</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong>--</strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                        <dd>周 <i class="icon_equal" title="上升"></i><b>--</b></dd>
                                                                        <dd>月 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl id="yiren_user">
                                                                        <dt><b>一人一城</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong>--</strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                        <dd>周 <i class="icon_equal" title="上升"></i><b>--</b></dd>
                                                                        <dd>月 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl id="muzhi_user">
                                                                        <dt><b>拇指阅读</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong>--</strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                        <dd>周 <i class="icon_equal" title="上升"></i><b>--</b></dd>
                                                                        <dd>月 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl id="er_user">
                                                                        <dt><b>二姑娘家</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong>--</strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                        <dd>周 <i class="icon_equal" title="上升"></i><b>--</b></dd>
                                                                        <dd>月 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl>
                                                                        <dt><b>江湖</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong>--</strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                        <dd>周 <i class="icon_equal" title="上升"></i><b>--</b></dd>
                                                                        <dd>月 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl>
                                                                        <dt><b>行周末</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong>--</strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                        <dd>周 <i class="icon_equal" title="上升"></i><b>--</b></dd>
                                                                        <dd>月 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td class="last">
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl>
                                                                        <dt><b>坏寻姐妹</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong>--</strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                        <dd>周 <i class="icon_equal" title="上升"></i><b>--</b></dd>
                                                                        <dd>月 <i class="icon_equal" title="下降"></i><b>--</b></dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            <!-- <div class="col-sm-6 input-group-time">
                                <div class="col-md-2"> -->
                            <ul class="calendar-plugin">
                                <li class="calendar-plugin-item1">
                                    <div class="dropdown">
                                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                        最近30天
                                        <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                            <li><a href="#" data-value="7" data-index="0">最近7天</a></li>
                                            <li><a href="#" data-value="15" data-index="1">最近15天</a></li>
                                            <li><a href="#" data-value="30" data-index="2">最近30天</a></li>
                                        </ul>
                                    </div>
                                </li>
                                <!-- </div> -->
                                <!-- <div class="col-sm-3"> -->
                                <li class="calendar-plugin-item2">
                                    <div>
                                        <input type="text" id="date-range1" value="" placeholder="请选择时间范围">               
                                    </div>
                                </li>
                                <!-- </div> -->
                                <li class="calendar-plugin-item1">
                                    <div class="dropdown">
                                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                        全部来源
                                        <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                            <li><a href="#" data-value="99999999" data-index="0" data-name="全部来源">全部来源</a></li>
                                            <li><a href="#" data-value="1" data-index="1" data-name="公众号搜索">公众号搜索</a></li>
                                            <li><a href="#" data-value="30" data-index="2" data-name="扫描二维码">扫描二维码</a>
                                            <li><a href="#" data-value="43" data-index="3" data-name="图文页右上角菜单">图文页右上角菜单</a>
                                            <li><a href="#" data-value="57" data-index="4" data-name="图文页内公众号名称">图文页内公众号名称</a>
                                            <li><a href="#" data-value="17" data-index="5" data-name="名片分享">名片分享</a>
                                            <li><a href="#" data-value="78" data-index="6" data-name="朋友圈广告">朋友圈广告</a>
                                            <li><a href="#" data-value="51" data-index="7" data-name="支付后关注">支付后关注</a>
                                            <li><a href="#" data-value="0" data-index="8" data-name="其他合计">其他合计</a>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                            &nbsp;
                            <span class="tools pull-right">
                                <a href="javascript:;" class="fa fa-chevron-down"></a>
                                <a href="javascript:;" class="fa fa-times"></a>
                            </span>
                        </header>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <div id="pie-chart" class="pie-chart">
                                            <div id="pie-chartContainer-total" style="width: 100%; height: 400px; text-align: left; padding: 0px; position: relative;">
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            <ul class="calendar-plugin">
                                <li class="calendar-plugin-item1">
                                    <div class="dropdown">
                                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                        最近30天
                                        <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                            <li><a href="#" data-value="7" data-index="0">最近7天</a></li>
                                            <li><a href="#" data-value="15" data-index="1">最近15天</a></li>
                                            <li><a href="#" data-value="30" data-index="2">最近30天</a></li>
                                        </ul>
                                    </div>
                                </li>                                
                                <li class="calendar-plugin-item2">
                                    <div>
                                        <input type="text" id="date-range2" value="" placeholder="请选择时间范围">               
                                    </div>
                                </li>
                                <li class="calendar-plugin-item1">
                                    <div class="dropdown">
                                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                        全部来源
                                        <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                            <li><a href="#" data-value="99999999" data-index="0" data-name="全部来源">全部来源</a></li>
                                            <li><a href="#" data-value="1" data-index="1" data-name="公众号搜索">公众号搜索</a></li>
                                            <li><a href="#" data-value="30" data-index="2" data-name="扫描二维码">扫描二维码</a>
                                            <li><a href="#" data-value="43" data-index="3" data-name="图文页右上角菜单">图文页右上角菜单</a>
                                            <li><a href="#" data-value="57" data-index="4" data-name="图文页内公众号名称">图文页内公众号名称</a>
                                            <li><a href="#" data-value="17" data-index="5" data-name="名片分享">名片分享</a>
                                            <li><a href="#" data-value="78" data-index="6" data-name="朋友圈广告">朋友圈广告</a>
                                            <li><a href="#" data-value="51" data-index="7" data-name="支付后关注">支付后关注</a>
                                            <li><a href="#" data-value="0" data-index="8" data-name="其他合计">其他合计</a>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                            &nbsp;
                            <span class="tools pull-right">
                                <a href="javascript:;" class="fa fa-chevron-down"></a>
                                <a href="javascript:;" class="fa fa-times"></a>
                            </span>
                        </header>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <div id="pie-chart" class="pie-chart">
                                            <div id="pie-chartContainer-channel" style="width: 100%; height: 400px; text-align: left; padding: 0px; position: relative;">
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
</block>
<block name="footer">
    <script id="teletext_table1" type="text/html">
    <div>
            <!-- 判断语句if else-->
            <%if(list.length>1) { %>
                <tr>
                    <!-- 循环语句 for-->
                    <%for(var i=0;i<list.length;i++){%>
                        <td><%=list[i]%></td>
                    <%}%>
                </tr>
            <%}else{%>
                <h2>没有list数据</h2>   
            <%}%>

    </div>  
    </script>
    <script>
        $(function () {
            time1=new Date(new Date()-2*24*60*60*1000);
            time2=new Date(new Date()-24*60*60*1000);
            time3=new Date(new Date()-7*24*60*60*1000);
            num1=(time1.getFullYear()+"-"+(time1.getMonth()+1).toString()+"-"+time1.getDate());
            num2=(time2.getFullYear()+"-"+(time2.getMonth()+1).toString()+"-"+time2.getDate());
            num3=(time3.getFullYear()+"-"+(time3.getMonth()+1).toString()+"-"+time3.getDate());
            //总粉丝数
            $.ajax({
                type:'get',
                url:"/Api/Data/getusercumulate/begin_date/"+num2+"/end_date/"+num2,
                success: function(res){
                    var data={
                        "list":[]
                    };
                    for(i=0;i<res.data.length;i++){
                        data['list'][i]=parseInt(res.data[i].list[0]['cumulate_user']);
                    }
                    for(i=res.data.length;i<8;i++){
                        data['list'][i]='--';
                    }

                    var bt=baidu.template;

                    var html=bt('teletext_table1',data);

                    document.getElementById('test').innerHTML=html;
                }
            });

            //昨日关键指标
            $.ajax({
                type:'get',
                url:"/Api/Data/getusercumulate/begin_date/"+num1+"/end_date/"+num2,
                success: function(res){
                    var user=[],add=[];
                    for(i=0;i<res.data.length;i++){
                        user[i]=parseInt(res.data[i].list[1]['cumulate_user']);
                        add[i]=(parseInt(res.data[i].list[1]['cumulate_user'])-parseInt(res.data[i].list[0]['cumulate_user']))/parseInt(res.data[i].list[0]['cumulate_user']);
                    }

                    //开始吧
                    $("#kai_user>dd>strong").html(user[0]);
                    $("#kai_user>dd:eq(1)>b").html((add[0]*100).toFixed(2)+"%");
                    if(add[0]>0){
                        $("#kai_user>dd:eq(1)>i").addClass('icon_up');
                    }
                    else if(add[0]<0){
                        $("#kai_user>dd:eq(1)>i").addClass('icon_down');
                    }
                    else{
                        $("#kai_user>dd:eq(1)>i").addClass('icon_equal');
                    }

                    //差评君
                    $("#cha_user>dd>strong").html(user[1]);
                    $("#cha_user>dd:eq(1)>b").html((add[1]*100).toFixed(2)+"%");
                    if(add[1]>0){
                        $("#cha_user>dd:eq(1)>i").addClass('icon_up');
                    }
                    else if(add[1]<0){
                        $("#cha_user>dd:eq(1)>i").addClass('icon_down');
                    }
                    else{
                        $("#cha_user>dd:eq(1)>i").addClass('icon_equal');
                    }

                    //一人一城
                    $("#yiren_user>dd>strong").html(user[2]);
                    $("#yiren_user>dd:eq(1)>b").html((add[2]*100).toFixed(2)+"%");
                    if(add[2]>0){
                        $("#yiren_user>dd:eq(1)>i").addClass('icon_up');
                    }
                    else if(add[2]<0){
                        $("#yiren_user>dd:eq(1)>i").addClass('icon_down');
                    }
                    else{
                        $("#yiren_user>dd:eq(1)>i").addClass('icon_equal');
                    }

                    //拇指阅读
                    $("#muzhi_user>dd>strong").html(user[3]);
                    $("#muzhi_user>dd:eq(1)>b").html((add[3]*100).toFixed(2)+"%");
                    if(add[3]>0){
                        $("#muzhi_user>dd:eq(1)>i").addClass('icon_up');
                    }
                    else if(add[3]<0){
                        $("#muzhi_user>dd:eq(1)>i").addClass('icon_down');
                    }
                    else{
                        $("#muzhi_user>dd:eq(1)>i").addClass('icon_equal');
                    }

                    //二姑娘
                    $("#er_user>dd>strong").html(user[4]);
                    $("#er_user>dd:eq(1)>b").html((add[4]*100).toFixed(2)+"%");
                    if(add[4]>0){
                        $("#er_user>dd:eq(1)>i").addClass('icon_up');
                    }
                    else if(add[4]<0){
                        $("#er_user>dd:eq(1)>i").addClass('icon_down');
                    }
                    else{
                        $("#er_user>dd:eq(1)>i").addClass('icon_equal');
                    }

                }
            });

            //综合指数趋势图
            trend(num3,num2);
            total(num3,num2);
            function trend(num3,num2){
                $.ajax({
                    type:'get',
                    url:"/Api/Data/getusersummary/begin_date/"+num3+"/end_date/"+num2,
                    success: function(res){
                        var date=[],j=0,user=[],sum=0;
                        date[0]=res.data[0].list[0]['ref_date'];
                        
                        //x轴 日期
                        for(i=0;i<res.data[0].list.length-1;i++){
                            if(new Date(res.data[0].list[i]['ref_date']).getTime()!=new Date(res.data[0].list[i+1]['ref_date']).getTime())
                            {
                                j++;
                                date[j]=res.data[0].list[i+1]['ref_date'];
                            }
                        }
                        chart1.xAxis[0].setCategories(date);

                        //新增关注人数
                        for(i=0;i<res.data.length;i++){
                            user[i]=new Array();
                        }
                        function add_user(a){
                            for(j=0;j<date.length;j++){
                                for(i=0;i<res.data[a].list.length;i++){
                                    if(res.data[a].list[i]['ref_date']==date[j]){
                                        sum+=res.data[a].list[i]['new_user'];
                                    }
                                }
                                user[a][j]=sum;
                                sum=0;
                            }
                        }
                        add_user(0); 
                        add_user(1);
                        add_user(2);
                        add_user(3);
                        add_user(4);

                        var user_add=[];
                        for(j=0;j<user[0].length;j++){
                            for(i=0;i<user.length;i++){
                                sum+=parseInt(user[i][j]);
                            }
                            user_add[j]=sum;
                            sum=0;
                        }
                        chart1.series[0].update({data:user_add});

                        //取消关注人数
                        var user2=[];
                        for(i=0;i<res.data.length;i++){
                            user2[i]=new Array();
                        }

                        function reduce_user(a){
                            for(j=0;j<date.length;j++){
                                for(i=0;i<res.data[a].list.length;i++){
                                    if(res.data[a].list[i]['ref_date']==date[j]){
                                        sum+=res.data[a].list[i]['cancel_user'];
                                    }
                                }
                                user2[a][j]=sum;
                                sum=0;
                            }
                        }
                        reduce_user(0); 
                        reduce_user(1);
                        reduce_user(2);
                        reduce_user(3);
                        reduce_user(4);

                        var user_reduce=[];
                        for(j=0;j<user2[0].length;j++){
                            for(i=0;i<user2.length;i++){
                                sum+=parseInt(user2[i][j]);
                            }
                            user_reduce[j]=sum;
                            sum=0;
                        }
                        chart1.series[1].update({data:user_reduce});

                        //净增人口
                        var raise_user=[];
                        for(i=0;i<user_add.length;i++){
                             raise_user[i]=parseInt(user_add[i])-parseInt(user_reduce[i]);
                        }
                        chart1.series[2].update({data:raise_user});                    
                    }
                });
            }
            function total(num3,num2){
                //累计人数
                $.ajax({
                    type:'get',
                    url:"/Api/Data/getusercumulate/begin_date/"+num3+"/end_date/"+num2,
                    success: function(res){
                        var total_user=[],sum=0,user=[];
                        for(i=0;i<res.data.length;i++){
                            user[i]=new Array();
                        }
                        for(j=0;j<res.data.length;j++){
                            for(i=0;i<res.data[0].list.length;i++){
                                user[j][i]=res.data[j].list[i]['cumulate_user'];
                            }
                        }
                        for(i=0;i<user[0].length;i++){
                            for(j=0;j<user.length;j++){
                                sum+=parseInt(user[j][i]);
                            }
                            total_user[i]=sum;
                            sum=0;
                        }
                        chart1.series[3].update({data:total_user});
                    }
                });
            }

            //用户渠道来源图
            table(num3,num2);
            function table(num3,num2){
                $.ajax({
                    type:'get',
                    url:"/Api/Data/getusersummary/begin_date/"+num3+"/end_date/"+num2,
                    success: function(res){
                        var user=[],kai_user=[],cha_user=[],yiren_user=[],muzhi_user=[],er_user=[];
                        source(kai_user,0);
                        source(cha_user,1);
                        source(yiren_user,2);
                        source(muzhi_user,3);
                        source(er_user,4);

                        chart2.series[0].update({data:kai_user});
                        chart2.series[0].update({name:'开始吧'});
                        chart2.series[1].update({data:cha_user});
                        chart2.series[1].update({name:'差评君'});
                        chart2.series[2].update({data:yiren_user});
                        chart2.series[2].update({name:'一人一城'});
                        chart2.series[3].update({data:muzhi_user});
                        chart2.series[3].update({name:'拇指阅读'});
                        chart2.series[4].update({data:er_user});
                        chart2.series[4].update({name:'二姑娘家'});

                        function source(user,a){
                            for(i=0;i<10;i++){
                                user[i]=0;
                            }

                            for(i=0;i<res.data[0].list.length;i++){
                                user[0]+=res.data[a].list[i]['new_user'];
                            }

                            for(i=0;i<res.data[0].list.length;i++){
                                if(res.data[a].list[i]['user_source']==0){
                                    user[1]+=res.data[a].list[i]['new_user'];
                                }
                                if(res.data[a].list[i]['user_source']==1){
                                    user[2]+=res.data[a].list[i]['new_user'];
                                }
                                if(res.data[a].list[i]['user_source']==17){
                                    user[3]+=res.data[a].list[i]['new_user'];
                                }
                                if(res.data[a].list[i]['user_source']==30){
                                    user[4]+=res.data[a].list[i]['new_user'];
                                }
                                if(res.data[a].list[i]['user_source']==43){
                                    user[5]+=res.data[a].list[i]['new_user'];
                                }
                                if(res.data[a].list[i]['user_source']==57){
                                    user[6]+=res.data[a].list[i]['new_user'];
                                }
                                if(res.data[a].list[i]['user_source']==75){
                                    user[7]+=res.data[a].list[i]['new_user'];
                                }
                                if(res.data[a].list[i]['user_source']==51){
                                    user[8]+=res.data[a].list[i]['new_user'];
                                }
                                if(res.data[a].list[i]['user_source']==78){
                                    user[9]+=res.data[a].list[i]['new_user'];
                                }

                            }
                        }
                    }
                });
            }
            
            

            /*日期选择范围*/
            $('#date-range1').dateRangePicker({
                format: 'YYYY-MM-DD',
                minDays:2,
                maxDays:7,
                endDate:new Date(new Date()-24*60*60*1000)
            }).bind('datepicker-change',function(event,obj)
            {
                obj=$('#date-range1').val();
                var arr=obj.split("to");
                num3=$.trim(arr[0]);
                num2=$.trim(arr[1]);
                trend(num3,num2);
                total(num3,num2);
            });
            $('#date-range2').dateRangePicker({
                format: 'YYYY-MM-DD',
                minDays:2,
                maxDays:7,
                endDate:new Date(new Date()-24*60*60*1000)
            }).bind('datepicker-change',function(event,obj)
            {
                obj=$('#date-range2').val();
                var arr=obj.split("to");
                num3=$.trim(arr[0]);
                num2=$.trim(arr[1]);
                table(num3,num2);
            });
            /*综合指数趋势图*/
            chart1=new Highcharts.Chart({
                title: {
                    text: '综合指数趋势图'

                },
                chart: {
                    type: 'spline',
                    renderTo:'pie-chartContainer-total'
                },
                xAxis: {
                    title: {
                        text: '时间'
                    },
                    tickmarkPlacement:'on'
                },
                yAxis: {
                    title: {
                        text: '人数'
                    },
                    labels: {
                        formatter: function() {
                            return this.value;
                        }
                    }

                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',
                    borderWidth: 0
                },
                series: [{
                    name: '新关注人数',
                    color:'#080807',
                },{
                    name: '取消关注人数',
                    color:'#04C255',
                },{
                    name: '净增人数',
                    color:'#1E15F6',
                },{
                    name: '累计人数',
                    color:'#FB0716',
                }],
                credits: {
                    enabled: false // 禁用版权信息
                }
            });

            chart2=new Highcharts.Chart({
                title: {
                    text: '用户来源渠道'
                },
                chart: {
                    type: 'spline',
                    renderTo:'pie-chartContainer-channel'
                },
                xAxis: {
                    title: {
                        text: '渠道'
                    },
                    tickmarkPlacement:'on',
                    categories: ['全部来源','其他合计','公众号搜索','名片分享','扫描二维码','图文页右上角菜单','图文页内公众号名称','公众号文章广告','支付后关注','朋友圈广告']
                },
                yAxis: {
                    title: {
                        text: '人数'
                    },
                    // min: 0,
                    // max: 3000,
                    // tickInterval:500,
                    labels: {
                        formatter: function() {
                            return this.value;
                        }
                    }

                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',
                    borderWidth: 0
                },
                series: [{
                    name: null,
                    color:'#080807',
                },{
                    name: null,
                    color:'#04C255'
                },{
                    name: null,
                    color:'#1E15F6',
                },{
                    name: null,
                    color:'#FB0716',
                },{
                    name: null,
                    color:'#aaa',
                }],
                credits: {
                    enabled: false // 禁用版权信息
                }
            });
        });
    </script>
</block>


