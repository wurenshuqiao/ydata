<extend name="Public:base" />
<block name="title">
    <title>message</title>
</block>
<block name="header"><script src="__PUBLIC__/admin/js/baiduTemplate.js"></script></block>
<block name="nav">
    <ul class="nav nav-pills nav-stacked custom-nav">
        <li><a href="../Index/index.html"><i class="fa fa-home"></i> <span>首页</span></a></li>
        <li class="menu-list"><a href=""><i class="fa fa-random"></i> <span>周期走势</span></a>
            <ul class="sub-menu-list">
                <li><a href="{:U('Trend/exponential')}"> 支持指数与参与指数</a></li>
                <li><a href="{:U('Trend/analyse')}"> 类目分析</a></li>
                <li><a href="{:U('Trend/participate')}"> 类目参与</a></li>
                <li><a href="{:U('Trend/line')}"> 项目上线</a></li>
                <li><a href="{:U('Trend/realtime')}"> 实时统计</a></li>
                <li><a href="{:U('Trend/timesharing')}"> 分时统计</a></li>
                <li><a href="{:U('Trend/download')}"> 下载量</a></li>
                <li><a href="{:U('Trend/register')}"> 用户周期</a></li>
                <li><a href="{:U('Trend/active')}"> 活跃用户</a></li>
            </ul>
        </li>
        <li class="menu-list"><a href=""><i class="fa fa-male"></i> <span>人群分析</span></a>
            <ul class="sub-menu-list">
                <li><a href="{:U('People/population')}"> 人群特性</a></li>
                <li><a href="{:U('People/support')}"> 用户支持</a></li>
                <li><a href="{:U('People/region')}"> 地域分析</a></li>
                <li><a href="{:U('People/hierarchy')}"> 消费层级</a></li>
                <li><a href="{:U('People/passes')}"> 消费次数</a></li>
            </ul>
        </li>
        <li class="menu-list"><a href=""><i class="fa fa-cogs"></i> <span>需求分析</span></a>
            <ul class="sub-menu-list">
                <li><a href="{:U('Require/dispersion')}"> 类目分布</a></li>
                <li><a href="{:U('Require/project')}"> 项目基础数据</a></li>
                <li><a href="{:U('Require/market')}"> 市场细分</a></li>
                <li><a href="{:U('Require/channel')}"> 渠道来源</a></li>
            </ul>
        </li>
        <li class="menu-list nav-active"><a href=""><i class="fa fa-comment"></i> <span>微信统计</span></a>
            <ul class="sub-menu-list">
                <li><a href="{:U('Statistics/user')}"> 用户分析</a></li>
                <li><a href="{:U('Statistics/teletext')}"> 图文分析</a></li>
                <li class="active"><a href="{:U('Statistics/message')}"> 消息分析</a></li>
            </ul>
        </li>
        <li><a href="{:U('Login/index')}"><i class="fa fa-sign-in"></i> <span>登录 页面</span></a></li>
    </ul>
</block>
<block name="content">
    <div class="wrapper">
        <div class="row">
            <div class="col-md-12">
                <div class="square-widget">
                    <div class="widget-container">
                        <div class="stepy-tab">
                            <ul id="default-titles" class="stepy-titles clearfix">
                                <li class="current-step" id="zonghezhishu">
                                    <a href="{:U('Statistics/message')}">综合指数</a>
                                </li>
                                <li id="kaishiba">
                                    <a href="{:U('Statistics/messagekaishiba')}">开始吧</a>
                                </li>
                                <li id="chaping">
                                    <a href="{:U('Statistics/messagechaping')}">差评</a>
                                </li>
                                <li id="yirenyicheng">
                                    <a href="{:U('Statistics/messageyirenyicheng')}">一人一城</a>
                                </li>
                                <li id="muzhiyuedu">
                                    <a href="{:U('Statistics/messagemuzhiyuedu')}">拇指阅读</a>
                                </li>
                                <li id="erguniangjia">
                                    <a href="{:U('Statistics/messageerguniangjia')}">二姑娘家</a>
                                </li>
                                <li id="jianghu">
                                    <a href="{:U('Statistics/messagejianghu')}">江湖</a>
                                </li>
                                <li id="xingzhoumo">
                                    <a href="{:U('Statistics/messagexingzhoumo')}">行周末</a>
                                </li>
                                <li id="huaixunjiemei">
                                    <a href="{:U('Statistics/messagehuaixunjiemei')}">坏寻姐妹</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="multiple-content">
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            昨日关键指标
                                <span class="tools pull-right">
                                    <a href="javascript:;" class="fa fa-chevron-down"></a>
                                    <a href="javascript:;" class="fa fa-times"></a>
                                 </span>
                        </header>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <div class="info_bd">
                                            <div class="content" id="js_keydata">
                                                <table class="ui_trendgrid ui_trendgrid_3">
                                                    <tbody>
                                                        <tr>
                                                            <td class="first">
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl id='kai_msg'>
                                                                        <dt><b>开始吧</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong></strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i></i><b></b></dd>
                                                                        <dd>周 <i></i>--</dd>
                                                                        <dd>月 <i></i>--</dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl id='cha_msg'>
                                                                        <dt><b>差评</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong></strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i></i><b></b></dd>
                                                                        <dd>周 <i></i>--</dd>
                                                                        <dd>月 <i></i>--</dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl id='yiren_msg'>
                                                                        <dt><b>一人一城</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong></strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i></i><b></b></dd>
                                                                        <dd>周 <i></i>--</dd>
                                                                        <dd>月 <i></i>--</dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl id='muzhi_msg'>
                                                                        <dt><b>拇指阅读</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong></strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i></i><b></b></dd>
                                                                        <dd>周 <i></i>--</dd>
                                                                        <dd>月 <i></i>--</dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl id='er_msg'>
                                                                        <dt><b>二姑娘家</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong></strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i></i><b></b></dd>
                                                                        <dd>周 <i></i>--</dd>
                                                                        <dd>月 <i></i>--</dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl>
                                                                        <dt><b>江湖</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong>--</strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i></i><b></b></dd>
                                                                        <dd>周 <i></i>--</dd>
                                                                        <dd>月 <i></i>--</dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl>
                                                                        <dt><b>行周末</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong>--</strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i></i><b></b></dd>
                                                                        <dd>周 <i></i>--</dd>
                                                                        <dd>月 <i></i>--</dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                            <td class="last">
                                                                <div class="ui_trendgrid_item">
                                                                    <div class="ui_trendgrid_chart"></div>
                                                                    <dl>
                                                                        <dt><b>坏寻姐妹</b></dt>
                                                                        <dd class="ui_trendgrid_number"><strong>--</strong><em class="ui_trendgrid_unit"></em></dd>
                                                                        <dd>日 <i></i><b></b></dd>
                                                                        <dd>周 <i></i>--</dd>
                                                                        <dd>月 <i></i>--</dd>
                                                                    </dl>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            <ul class="calendar-plugin">
                                <li class="calendar-plugin-item1">
                                    <div class="dropdown">
                                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                        最近7天
                                        <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                            <li><a href="#" data-value="7" data-index="0">最近7天</a></li>
                                            <li><a href="#" data-value="15" data-index="1">最近15天</a></li>
                                            <li><a href="#" data-value="30" data-index="2">最近30天</a></li>
                                        </ul>
                                    </div>
                                </li>                                
                                <li class="calendar-plugin-item2">
                                    <div>
                                        <input type="text" id="date-range1" value="" placeholder="请选择时间范围">               
                                    </div>
                                </li>
                                <li class="calendar-plugin-item1">
                                    <div class="dropdown">
                                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                        全部来源
                                        <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                            <li><a href="#" data-value="99999999" data-index="0" data-name="全部来源">全部来源</a></li>
                                            <li><a href="#" data-value="1" data-index="1" data-name="公众号搜索">公众号搜索</a></li>
                                            <li><a href="#" data-value="30" data-index="2" data-name="扫描二维码">扫描二维码</a>
                                            <li><a href="#" data-value="43" data-index="3" data-name="图文页右上角菜单">图文页右上角菜单</a>
                                            <li><a href="#" data-value="57" data-index="4" data-name="图文页内公众号名称">图文页内公众号名称</a>
                                            <li><a href="#" data-value="17" data-index="5" data-name="名片分享">名片分享</a>
                                            <li><a href="#" data-value="78" data-index="6" data-name="朋友圈广告">朋友圈广告</a>
                                            <li><a href="#" data-value="51" data-index="7" data-name="支付后关注">支付后关注</a>
                                            <li><a href="#" data-value="0" data-index="8" data-name="其他合计">其他合计</a>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                            &nbsp;
                            <span class="tools pull-right">
                                <a href="javascript:;" class="fa fa-chevron-down"></a>
                                <a href="javascript:;" class="fa fa-times"></a>
                            </span>
                        </header>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <div id="pie-chart" class="pie-chart">
                                            <div id="pie-chartContainer-total" style="width: 100%; height: 400px; text-align: left; padding: 0px; position: relative;">
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </section>
                </div>

            </div>
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            消息发送次数分布
                            <span class="tools pull-right">
                                <a href="javascript:;" class="fa fa-chevron-down"></a>
                                <a href="javascript:;" class="fa fa-times"></a>
                             </span>
                        </header>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <div id="pie-chart" class="pie-chart">
                                            <div id="pie-chartContainer-message1" style="width: 100%; height: 400px; text-align: left; padding: 0px; position: relative;">     
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <div id="pie-chart" class="pie-chart">
                                            <div id="pie-chartContainer-message2" style="width: 100%; height: 400px; text-align: left; padding: 0px; position: relative;">     
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <div id="pie-chart" class="pie-chart">
                                            <div id="pie-chartContainer-message3" style="width: 100%; height: 400px; text-align: left; padding: 0px; position: relative;">     
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <table class="table table-bordered">
                                            <thead>
                                            <tr>
                                                <th>时间</th>
                                                <th>次数</th>
                                                <th>开始吧</th>
                                                <th>差评</th>
                                                <th>一人一城</th>
                                                <th>拇指阅读</th>
                                                <th>二姑娘家</th>
                                                <!-- <th>江湖</th>
                                                <th>行周末</th>
                                                <th>坏寻姐妹</th> -->
                                            </tr>
                                            </thead>
                                            <tbody id="text1">
                                                    
                                            </tbody>
                                        </table>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <table class="table table-bordered">
                                            <thead>
                                            <tr>
                                                <th>时间</th>
                                                <th>次数</th>
                                                <th>开始吧</th>
                                                <th>差评</th>
                                                <th>一人一城</th>
                                                <th>拇指阅读</th>
                                                <th>二姑娘家</th>
                                                <!-- <th>江湖</th>
                                                <th>行周末</th>
                                                <th>坏寻姐妹</th> -->
                                            </tr>
                                            </thead>
                                            <tbody id="text2">
                                            
                                            </tbody>
                                        </table>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <table class="table table-bordered">
                                            <thead>
                                            <tr>
                                                <th>时间</th>
                                                <th>次数</th>
                                                <th>开始吧</th>
                                                <th>差评</th>
                                                <th>一人一城</th>
                                                <th>拇指阅读</th>
                                                <th>二姑娘家</th>
                                               <!--  <th>江湖</th>
                                                <th>行周末</th>
                                                <th>坏寻姐妹</th> -->
                                            </tr>
                                            </thead>
                                            <tbody id="text3">
                                            
                                            </tbody>
                                        </table>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            人均发送次数
                            <span class="tools pull-right">
                                <a href="javascript:;" class="fa fa-chevron-down"></a>
                                <a href="javascript:;" class="fa fa-times"></a>
                             </span>
                        </header>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <div id="pie-chart" class="pie-chart">
                                            <div id="pie-chartContainer-average" style="width: 100%; height: 400px; text-align: left; padding: 0px; position: relative;">
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="col-sm-12">
                                <section class="panel">
                                    <div class="panel-body">
                                        <table class="table table-bordered">
                                            <thead>
                                            <tr>
                                                <th>时间</th>
                                                <th>开始吧</th>
                                                <th>差评</th>
                                                <th>一人一城</th>
                                                <th>拇指阅读</th>
                                                <th>二姑娘家</th>
                                                <!-- <th>江湖</th>
                                                <th>行周末</th>
                                                <th>坏寻姐妹</th> -->
                                            </tr>
                                            </thead>
                                            <tbody id="text4">
                                            
                                            </tbody>
                                        </table>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
</block>
<block name="footer">
    <script id="teletext_table1" type="text/html">
        <div>
            <!-- 判断语句if else-->
            <%if(first[0].length>1) { %>
                <%for(var j=0;j<first.length;j++){%>
                    <tr>
                        <!-- 循环语句 for-->
                        <%for(var i=0;i<first[0].length;i++){%>
                            <td><%=first[j][i]%></td>
                        <%}%>
                    </tr>
                <%}%>
            <%}else{%>
                <h2>没有list数据</h2>   
            <%}%>
        </div>  
    </script>
    <script id="teletext_table2" type="text/html">
        <div>
            <!-- 判断语句if else-->
            <%if(second[0].length>1) { %>
                <%for(var j=0;j<second.length;j++){%>
                    <tr>
                        <!-- 循环语句 for-->
                        <%for(var i=0;i<second[0].length;i++){%>
                            <td><%=second[j][i]%></td>
                        <%}%>
                    </tr>
                <%}%>
            <%}else{%>
                <h2>没有list数据</h2>   
            <%}%>
        </div>  
    </script>
    <script id="teletext_table3" type="text/html">
        <div>
            <!-- 判断语句if else-->
            <%if(third[0].length>1) { %>
                <%for(var j=0;j<third.length;j++){%>
                    <tr>
                        <!-- 循环语句 for-->
                        <%for(var i=0;i<third[0].length;i++){%>
                            <td><%=third[j][i]%></td>
                        <%}%>
                    </tr>
                <%}%>
            <%}else{%>
                <h2>没有list数据</h2>   
            <%}%>
        </div>  
    </script>
    <script id="teletext_table4" type="text/html">
        <div>
            <!-- 判断语句if else-->
            <%if(fourth[0].length>1) { %>
                <%for(var j=0;j<fourth.length;j++){%>
                    <tr>
                        <!-- 循环语句 for-->
                        <%for(var i=0;i<fourth[0].length;i++){%>
                            <td><%=fourth[j][i]%></td>
                        <%}%>
                    </tr>
                <%}%>
            <%}else{%>
                <h2>没有list数据</h2>   
            <%}%>
        </div>  
    </script>
    <script>
        $(function () {
            time1=new Date(new Date()-7*24*60*60*1000);
            time2=new Date(new Date()-24*60*60*1000);
            time3=new Date(new Date()-2*24*60*60*1000);
            num1=(time1.getFullYear()+"-"+(time1.getMonth()+1).toString()+"-"+time1.getDate());
            num2=(time2.getFullYear()+"-"+(time2.getMonth()+1).toString()+"-"+time2.getDate());
            num3=(time3.getFullYear()+"-"+(time3.getMonth()+1).toString()+"-"+time3.getDate());
            //昨日关键指标
            $.ajax({
                    type:'get',
                    url:'/Api/Data/getupstreammsg/begin_date/'+num3+'/end_date/'+num2,
                    success:function(res){
                        console.log(res);
                        
                        var sum,msg_user1,msg_user2;
                        function target(type){
                            sum=0,msg_user1=0,msg_user2=0;
                            for(i=0;i<res.data[type].list.length;i++){
                                if(res.data[type].list[i]['ref_date']==res.data[type].list[0]['ref_date']){
                                sum+=res.data[type].list[i]['msg_user'];
                                }
                            }
                            msg_user1=sum;

                            sum=0;
                            for(i=0;i<res.data[type].list.length;i++){
                                if(res.data[type].list[i]['ref_date']==res.data[type].list[res.data[type].list.length-1]['ref_date']){
                                sum+=res.data[type].list[i]['msg_user'];
                                }
                            }
                            msg_user2=sum;

                            vary_msg=(parseInt(msg_user2)-parseInt(msg_user1))/parseInt(msg_user1)*100;
                        }
                        //开始吧
                        target(0);
                        $('#kai_msg>dd>strong').html(msg_user2);
                        $('#kai_msg>dd:eq(1)>b').html(vary_msg.toFixed(2)+'%');
                        if(vary_msg>0){
                            $('#kai_msg>dd:eq(1)>i').addClass('icon_up');
                        }else if(vary_msg<0){
                            $('#kai_msg>dd:eq(1)>i').addClass('icon_down');
                        }else{
                            $('#kai_msg>dd:eq(1)>i').addClass('icon_equal');
                        }

                        //差评君
                        target(1);
                        $('#cha_msg>dd>strong').html(msg_user2);
                        $('#cha_msg>dd:eq(1)>b').html(vary_msg.toFixed(2)+'%');
                        if(vary_msg>0){
                            $('#cha_msg>dd:eq(1)>i').addClass('icon_up');
                        }else if(vary_msg<0){
                            $('#cha_msg>dd:eq(1)>i').addClass('icon_down');
                        }else{
                            $('#cha_msg>dd:eq(1)>i').addClass('icon_equal');
                        }

                        //一人一城
                        target(2);
                        $('#yiren_msg>dd>strong').html(msg_user2);
                        $('#yiren_msg>dd:eq(1)>b').html(vary_msg.toFixed(2)+'%');
                        if(vary_msg>0){
                            $('#yiren_msg>dd:eq(1)>i').addClass('icon_up');
                        }else if(vary_msg<0){
                            $('#yiren_msg>dd:eq(1)>i').addClass('icon_down');
                        }else{
                            $('#yiren_msg>dd:eq(1)>i').addClass('icon_equal');
                        }

                        //拇指阅读
                        target(3);
                        $('#muzhi_msg>dd>strong').html(msg_user2);
                        $('#muzhi_msg>dd:eq(1)>b').html(vary_msg.toFixed(2)+'%');
                        if(vary_msg>0){
                            $('#muzhi_msg>dd:eq(1)>i').addClass('icon_up');
                        }else if(vary_msg<0){
                            $('#muzhi_msg>dd:eq(1)>i').addClass('icon_down');
                        }else{
                            $('#muzhi_msg>dd:eq(1)>i').addClass('icon_equal');
                        }

                        //二姑娘
                        target(4);
                        $('#er_msg>dd>strong').html(msg_user2);
                        $('#er_msg>dd:eq(1)>b').html(vary_msg.toFixed(2)+'%');
                        if(vary_msg>0){
                            $('#er_msg>dd:eq(1)>i').addClass('icon_up');
                        }else if(vary_msg<0){
                            $('#er_msg>dd:eq(1)>i').addClass('icon_down');
                        }else{
                            $('#er_msg>dd:eq(1)>i').addClass('icon_equal');
                        }
                }
            });
            //综合指数趋势图
            function trend(num1,num2){
                $.ajax({
                    type:'get',
                    url:'/Api/Data/getupstreammsg/begin_date/'+num1+'/end_date/'+num2,
                    success:function(res){

                        //x轴时间
                        var j=0,date=[];
                        date[j]=res.data[0].list[0]['ref_date'];
                        for(i=0;i<res.data[0].list.length-1;i++){
                            if(new Date(res.data[0].list[i]['ref_date']).getTime()!=new Date(res.data[0].list[i+1]['ref_date']).getTime())
                            {
                                j++;
                                date[j]=res.data[0].list[i+1]['ref_date'];
                            }
                        }
                        chart1.xAxis[0].setCategories(date);
                        chart5.xAxis[0].setCategories(date);

                        var total=[],sum=0,user_msg=[],count_msg=[],average_msg=[];
                        for(i=0;i<res.data.length;i++){
                            total[i]=new Array();
                        }
                        function user_count(a,b){
                            for(j=0;j<date.length;j++){
                                for(i=0;i<res.data[a].list.length;i++){
                                    if(res.data[a].list[i]['ref_date']==date[j]){
                                        sum+=res.data[a].list[i][b];
                                    }
                                }
                                total[a][j]=sum;
                                sum=0;
                            }
                        }

                        //消息发送人数
                        user_count(0,'msg_user');
                        user_count(1,'msg_user');
                        user_count(2,'msg_user');
                        user_count(3,'msg_user');
                        user_count(4,'msg_user');
                        for(i=0;i<total[0].length;i++){
                            for(j=0;j<total.length;j++){
                                sum+=total[j][i];
                            }
                            user_msg[i]=sum;
                            sum=0;
                        }
                        chart1.series[0].update({data:user_msg});

                        // 消息发送次数
                        user_count(0,'msg_count');
                        user_count(1,'msg_count');
                        user_count(2,'msg_count');
                        user_count(3,'msg_count');
                        user_count(4,'msg_count');
                        for(i=0;i<total[0].length;i++){
                            for(j=0;j<total.length;j++){
                                sum+=total[j][i];
                            }
                            count_msg[i]=sum;
                            sum=0;
                        }
                        chart1.series[1].update({data:count_msg});

                        //人均发送次数
                        var average=0;
                        for(i=0;i<count_msg.length;i++){
                            a=parseInt(count_msg[i])/parseInt(user_msg[i]);
                            average_msg[i]=parseFloat(a.toFixed(2));
                        }
                        chart1.series[2].update({data:average_msg});
                    }
                });
            }
            trend(num1,num2);
            
            //消息发送次数分布
            function send_count(num1,num2){
                $.ajax({
                    type:'get',
                    url:'/Api/Data/getupstreammsgdist/begin_date/'+num1+'/end_date/'+num2,
                    success:function(res){

                        var user=[];
                        function msg_user(a,b){
                            var sum=0;
                            for(i=0;i<res.data[a].list.length;i++){
                                if(res.data[a].list[i]['count_interval']==b){
                                    sum+=res.data[a].list[i]['msg_user'];
                                }
                            }
                            user[a]=sum;
                        }

                            //1-5次
                            msg_user(0,1); 
                            msg_user(1,1);
                            msg_user(2,1);
                            msg_user(3,1);
                            msg_user(4,1);
                            chart2.series[0].update({data:user});

                            //6-10次
                            msg_user(0,2); 
                            msg_user(1,2);
                            msg_user(2,2);
                            msg_user(3,2);
                            msg_user(4,2);
                            chart3.series[0].update({data:user});

                            //11-15次
                            msg_user(0,3); 
                            msg_user(1,3);
                            msg_user(2,3);
                            msg_user(3,3);
                            msg_user(4,3);
                            chart4.series[0].update({data:user});


                    }
                })
            }
            send_count(num1,num2);

            //表格1-3
            function send_distribute(num1,num2){
                $.ajax({
                    type:'get',
                    url:'/Api/Data/getupstreammsgdist/begin_date/'+num1+'/end_date/'+num2,
                    success:function(res){
                        var j=0,date=[],user_count=[],k=0;
                        var time={
                            'first':[],
                            'second':[],
                            'third':[],
                        }
                        
                        date[j]=res.data[0].list[0]['ref_date'];
                        for(i=0;i<res.data[0].list.length-1;i++){
                            if(new Date(res.data[0].list[i]['ref_date']).getTime()!=new Date(res.data[0].list[i+1]['ref_date']).getTime())
                            {
                                j++;
                                date[j]=res.data[0].list[i+1]['ref_date'];
                            }
                        }

                        for(k=0;k<date.length;k++){
                            user_count[k]=new Array();
                        }
                        
                        for(k=0;k<date.length;k++){
                            user_count[k][0]=date[k];
                           
                        }

                        var sum=0;
                        function sum_user(x,y,z){
                        for(k=0;k<date.length;k++){
                            user_count[k][1]=z;
                        }    
                        for(j=0;j<date.length;j++){
                            for(i=0;i<res.data[x].list.length;i++){
                                 if(new Date(res.data[x].list[i]['ref_date']).getTime()==new Date(date[j]).getTime()&&res.data[x].list[i]['count_interval']==y){
                                     sum+=res.data[x].list[i]['msg_user'];
                                 }
                            }
                            user_count[j][x+2]=sum;       
                            sum=0;    
                        }
                    }
                        //1-5次
                        sum_user(0,1,'1-5次');
                        sum_user(1,1,'1-5次');
                        sum_user(2,1,'1-5次');
                        sum_user(3,1,'1-5次');
                        sum_user(4,1,'1-5次');

                        for(k=0;k<date.length;k++){
                            time['first'][k]=new Array();
                        }

                        for(i=0;i<user_count.length;i++){
                            for(j=0;j<user_count[0].length;j++){
                                time['first'][i][j]=user_count[i][j];
                            }
                        }

                        //6-10次
                        sum_user(0,2,'6-10次');
                        sum_user(1,2,'6-10次');
                        sum_user(2,2,'6-10次');
                        sum_user(3,2,'6-10次');
                        sum_user(4,2,'6-10次');
                        for(k=0;k<date.length;k++){
                            time['second'][k]=new Array();
                        }

                        for(i=0;i<user_count.length;i++){
                            for(j=0;j<user_count[0].length;j++){
                                time['second'][i][j]=user_count[i][j];
                            }
                        }

                        //10次以上
                        sum_user(0,3,'10次以上');
                        sum_user(1,3,'10次以上');
                        sum_user(2,3,'10次以上');
                        sum_user(3,3,'10次以上');
                        sum_user(4,3,'10次以上');

                        for(k=0;k<date.length;k++){
                            time['third'][k]=new Array();
                        }

                        for(i=0;i<user_count.length;i++){
                            for(j=0;j<user_count[0].length;j++){
                                time['third'][i][j]=user_count[i][j];
                            }
                        }

                        var bt=baidu.template;

                        var html1=bt('teletext_table1',time);
                        var html2=bt('teletext_table2',time);
                        var html3=bt('teletext_table3',time);

                        document.getElementById('text1').innerHTML=html1;
                        document.getElementById('text2').innerHTML=html2;
                        document.getElementById('text3').innerHTML=html3;
                    }
                })
            }
            send_distribute(num1,num2);

            // 表格4
            function average_count(num1,numn2){
                $.ajax({
                    type:'get',
                    url:'/Api/Data/getupstreammsg/begin_date/'+num1+'/end_date/'+num2,
                    success:function(res){
                        
                        var j=0,date=[],user_count=[],k=0;
                        var time={
                                'fourth':[],
                            }

                        date[j]=res.data[0].list[0]['ref_date'];
                        for(i=0;i<res.data[0].list.length-1;i++){
                                if(new Date(res.data[0].list[i]['ref_date']).getTime()!=new Date(res.data[0].list[i+1]['ref_date']).getTime())
                                {
                                    j++;
                                    date[j]=res.data[0].list[i+1]['ref_date'];
                                }
                            }
                            // chart5.xAxis[0].setCategories(date);

                        for(k=0;k<date.length;k++){
                                user_count[k]=new Array();
                            }
                            
                        for(k=0;k<date.length;k++){
                                user_count[k][0]=date[k];  
                            }

                        var sum=0,user1=[],count1=[];
                        var per=new Array();
                        function per_count(m,n){
                            for(j=0;j<date.length;j++){
                                for(i=0;i<res.data[m].list.length;i++){
                                        if(new Date(res.data[m].list[i]['ref_date']).getTime()==new Date(date[j]).getTime()){
                                             sum+=res.data[m].list[i]['msg_user'];
                                        }
                                    }
                                    user1[j]=sum;
                                    sum=0;
                            } 
                            sum=0;;
                            for(j=0;j<date.length;j++){
                                for(i=0;i<res.data[m].list.length;i++){
                                        if(new Date(res.data[m].list[i]['ref_date']).getTime()==new Date(date[j]).getTime()){
                                             sum+=res.data[m].list[i]['msg_count'];
                                        }
                                    }
                                    count1[j]=sum;
                                    sum=0;
                            }
                            for(k=0;k<date.length;k++){
                                a=(parseInt(count1[k])/parseInt(user1[k]));
                                per[k]=parseFloat(a.toFixed(1));
                            }
                            for(k=0;k<date.length;k++){
                                 user_count[k][n]=per[k];
                            }
                        }


                        per_count(0,1);
                        chart5.series[0].update({data:per});
                        per_count(1,2);
                        chart5.series[1].update({data:per});
                        per_count(2,3);
                        chart5.series[2].update({data:per});
                        per_count(3,4);
                        chart5.series[3].update({data:per});
                        per_count(4,5);
                        chart5.series[4].update({data:per});

                        for(k=0;k<date.length;k++){
                                time['fourth'][k]=new Array();
                            }

                        for(i=0;i<user_count.length;i++){
                            for(j=0;j<user_count[0].length;j++){
                                    time['fourth'][i][j]=user_count[i][j];
                                }
                        }
                        var bt=baidu.template;
                        var html4=bt('teletext_table4',time);
                        document.getElementById('text4').innerHTML=html4;
                    }
                })
            }
            average_count(num1,num2);
            /*日期选择范围*/
            $('#date-range1').dateRangePicker({
                format: 'YYYY-MM-DD',
                minDays:2,
                maxDays:7,
                endDate:new Date(new Date()-24*60*60*1000)
            }).bind('datepicker-change',function(event,obj)
            {
                obj=$('#date-range1').val();
                var arr=obj.split("to");
                num1=$.trim(arr[0]);
                num2=$.trim(arr[1]);
                trend(num1,num2);
                send_count(num1,num2);
                send_distribute(num1,num2);
                average_count(num1,num2);
            });
            
            /*综合指数趋势图*/
            chart1=new Highcharts.Chart({
                title: {
                    text: '综合指数趋势图'

                },
                chart: {
                    type: 'spline',
                    renderTo:'pie-chartContainer-total'
                },
                xAxis: {
                    title: {
                        text: '时间'
                    },
                    tickmarkPlacement:'on',
                    categories: []
                },
                yAxis: {
                    title: {
                        text: '人数'
                    },
                    // min: 0,
                    // max: 5000,
                    // tickInterval:1000,
                    labels: {
                        formatter: function() {
                            return this.value;
                        }
                    }

                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',
                    borderWidth: 0
                },
                series: [{
                    name: '消息发送人数',
                    color:'#04C255',
                },{
                    name: '消息发送次数',
                    color:'#1E15F6',
                },{
                    name: '人均发送次数',
                    color:'#FB0716',
                }],
                credits: {
                    enabled: false // 禁用版权信息
                }
            });
            /*消息发送次数分布柱状图*/
            chart2=new Highcharts.Chart({
                chart: {
                    type: 'column',
                    renderTo:'pie-chartContainer-message1'
                },
                title: {
                    text: '1-5次',
                },
                xAxis: {
                    title: {
                        text: null
                    },
                    categories: ['开始吧', '差评', '一人一城', '拇指阅读', '二姑娘家','江湖', '行周末', '坏寻姐妹']
                },
                yAxis: {
                    title: {
                        text: '人数'
                    },
                    labels: {
                        formatter: function() {
                            return this.value;
                        }
                    }
                },
                tooltip: {
                    headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                    pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                        '<td style="padding:0"><b>{point.y}人</b></td></tr>',
                    footerFormat: '</table>',
                    shared: true,
                    useHTML: true
                },
                plotOptions: {
                    column: {
                        pointPadding: 0.2,
                        borderWidth: 0
                    }
                },
                series: [{
                    name: '人数',
                    dataLabels: {
                        enabled: true,
                        align: 'center',
                        style: {
                            fontWeight: 'bold'
                        },
                        x: 0,
                        y:-5,
                        color: '#FFFFFF',
                        verticalAlign: 'middle',
                        overflow: true,
                        crop: false
                    }
                    
                }],
                credits: {
                    enabled: false // 禁用版权信息
                }
            });

            chart3=new Highcharts.Chart({
                chart: {
                    type: 'column',
                    renderTo:'pie-chartContainer-message2'
                },
                title: {
                    text: '6-10次'
                },
                xAxis: {
                    title: {
                        text: null
                    },
                    categories: ['开始吧', '差评', '一人一城', '拇指阅读', '二姑娘家','江湖', '行周末', '坏寻姐妹']
                },
                yAxis: {
                    title: {
                        text: '人数'
                    },
                    labels: {
                        formatter: function() {
                            return this.value;
                        }
                    }
                },
                tooltip: {
                    headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                    pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                        '<td style="padding:0"><b>{point.y}人</b></td></tr>',
                    footerFormat: '</table>',
                    shared: true,
                    useHTML: true
                },
                plotOptions: {
                    column: {
                        pointPadding: 0.2,
                        borderWidth: 0
                    }
                },
                series: [{
                    name: '人数',
                    dataLabels: {
                        enabled: true,
                        align: 'center',
                        style: {
                            fontWeight: 'bold'
                        },
                        x: 0,
                        y:-5,
                        color: '#FFFFFF',
                        verticalAlign: 'middle',
                        overflow: true,
                        crop: false
                    }
                    
                }],
                credits: {
                    enabled: false // 禁用版权信息
                }
            });
            
            chart4=new Highcharts.Chart({
                chart: {
                    type: 'column',
                    renderTo:'pie-chartContainer-message3'
                },
                title: {
                    text: '10次以上'
                },
                xAxis: {
                    title: {
                        text: null
                    },
                    categories: ['开始吧', '差评', '一人一城', '拇指阅读', '二姑娘家','江湖', '行周末', '坏寻姐妹']
                },
                yAxis: {
                    title: {
                        text: '人数'
                    },
                    labels: {
                        formatter: function() {
                            return this.value;
                        }
                    }
                },
                tooltip: {
                    headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                    pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                        '<td style="padding:0"><b>{point.y}人</b></td></tr>',
                    footerFormat: '</table>',
                    shared: true,
                    useHTML: true
                },
                plotOptions: {
                    column: {
                        pointPadding: 0.2,
                        borderWidth: 0
                    }
                },
                series: [{
                    name: '人数',
                    dataLabels: {
                        enabled: true,
                        align: 'center',
                        style: {
                            fontWeight: 'bold'
                        },
                        x: 0,
                        y:-5,
                        color: '#FFFFFF',
                        verticalAlign: 'middle',
                        overflow: true,
                        crop: false
                    }
                    
                }],
                credits: {
                    enabled: false // 禁用版权信息
                }
            });
            /*人均发送次数趋势图*/
            chart5=new Highcharts.Chart({
                title: {
                    text: '人均发送次数趋势图'

                },
                chart: {
                    type: 'spline',
                    renderTo:'pie-chartContainer-average'
                },
                xAxis: {
                    title: {
                        text: null
                    },
                    tickmarkPlacement:'on',
                    categories: []
                },
                yAxis: {
                    title: {
                        text: null
                    },
                    // min: 0,
                    // max: 5,
                    // tickInterval:1,
                    labels: {
                        formatter: function() {
                            return this.value;
                        }
                    }

                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',
                    borderWidth: 0
                },
                series: [{
                    name: '开始吧',
                    data: []
                }, {
                    name: '差评',
                    data: []
                }, {
                    name: '一人一城',
                    data: []
                }, {
                    name: '拇指阅读',
                    data: []
                }, {
                    name: '二姑娘家',
                    data: []
                }],
                credits: {
                    enabled: false // 禁用版权信息
                }
            });         
        });

    </script>
</block>
